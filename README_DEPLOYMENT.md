# LangChain ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†å¦‚ä½•å°† LangChain åº”ç”¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

## ğŸ“‹ ç›®å½•ç»“æ„

```
LangChain/
â”œâ”€â”€ 18_production_deployment.py    # ç”Ÿäº§çº§åº”ç”¨ä»£ç 
â”œâ”€â”€ Dockerfile                     # Docker é•œåƒé…ç½®
â”œâ”€â”€ docker-compose.yml             # å®¹å™¨ç¼–æ’é…ç½®
â”œâ”€â”€ requirements-production.txt     # ç”Ÿäº§ç¯å¢ƒä¾èµ–
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ nginx.conf                # Nginx é…ç½®
â”œâ”€â”€ monitoring/
â”‚   â”œâ”€â”€ prometheus.yml            # Prometheus é…ç½®
â”‚   â””â”€â”€ grafana/
â”‚       â””â”€â”€ provisioning/         # Grafana é…ç½®
â”œâ”€â”€ deploy.sh                     # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ load_test.py                  # è´Ÿè½½æµ‹è¯•è„šæœ¬
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README_DEPLOYMENT.md          # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

#### ç³»ç»Ÿè¦æ±‚
- Docker 20.10+
- Docker Compose 2.0+
- è‡³å°‘ 2GB RAM
- è‡³å°‘ 2GB å¯ç”¨ç£ç›˜ç©ºé—´

#### å®‰è£…ä¾èµ–
```bash
# å®‰è£… Docker (Ubuntu/Debian)
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£… Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
nano .env
```

å¿…é¡»é…ç½®çš„ç¯å¢ƒå˜é‡ï¼š
- `ZHIPUAI_API_KEY`: æ™ºè°±AI APIå¯†é’¥
- `SECRET_KEY`: åº”ç”¨å¯†é’¥ï¼ˆç”¨äºJWTç­¾åï¼‰

### 3. éƒ¨ç½²åº”ç”¨

```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰
./deploy.sh

# æˆ–æ‰‹åŠ¨éƒ¨ç½²
docker-compose up -d
```

### 4. éªŒè¯éƒ¨ç½²

è®¿é—®ä»¥ä¸‹åœ°å€éªŒè¯éƒ¨ç½²ï¼š

- **API æœåŠ¡**: http://localhost:8000
- **API æ–‡æ¡£**: http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/admin123)

## ğŸ”§ è¯¦ç»†é…ç½®

### Docker é…ç½®

#### Dockerfile ç‰¹æ€§
- ä½¿ç”¨ Python 3.11 slim åŸºç¡€é•œåƒ
- å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–é•œåƒå¤§å°
- é root ç”¨æˆ·è¿è¡Œ
- å¥åº·æ£€æŸ¥é…ç½®
- ä¼˜åŒ–çš„ä¾èµ–å®‰è£…

#### docker-compose.yml æœåŠ¡
- **langchain-app**: ä¸»åº”ç”¨æœåŠ¡
- **redis**: ç¼“å­˜æœåŠ¡
- **prometheus**: ç›‘æ§æœåŠ¡
- **grafana**: å¯è§†åŒ–æœåŠ¡
- **nginx**: åå‘ä»£ç†æœåŠ¡

### Nginx é…ç½®

#### ä¸»è¦åŠŸèƒ½
- åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡
- Gzip å‹ç¼©
- é€Ÿç‡é™åˆ¶
- å®‰å…¨å¤´è®¾ç½®
- é™æ€æ–‡ä»¶æœåŠ¡

#### é…ç½®æ–‡ä»¶ä½ç½®
```
nginx/
â”œâ”€â”€ nginx.conf          # ä¸»é…ç½®æ–‡ä»¶
â””â”€â”€ ssl/               # SSL è¯ä¹¦ç›®å½•
```

### ç›‘æ§é…ç½®

#### Prometheus æŒ‡æ ‡
- åº”ç”¨æ€§èƒ½æŒ‡æ ‡
- ç³»ç»Ÿèµ„æºæŒ‡æ ‡
- è‡ªå®šä¹‰ä¸šåŠ¡æŒ‡æ ‡

#### Grafana ä»ªè¡¨æ¿
- ç³»ç»Ÿæ¦‚è§ˆ
- æ€§èƒ½ç›‘æ§
- é”™è¯¯ç»Ÿè®¡

## ğŸ”’ å®‰å…¨é…ç½®

### 1. API å®‰å…¨
- JWT è®¤è¯
- é€Ÿç‡é™åˆ¶
- CORS é…ç½®
- è¯·æ±‚å¤§å°é™åˆ¶

### 2. ç½‘ç»œå®‰å…¨
- é˜²ç«å¢™é…ç½®
- SSL/TLS åŠ å¯†
- å®‰å…¨å¤´è®¾ç½®

### 3. åº”ç”¨å®‰å…¨
- é root ç”¨æˆ·è¿è¡Œ
- å¯†é’¥ç®¡ç†
- è¾“å…¥éªŒè¯

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. åº”ç”¨ç›‘æ§
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f langchain-app

# æŸ¥çœ‹ç³»ç»ŸæŒ‡æ ‡
curl http://localhost:8000/metrics
```

### 2. ç³»ç»Ÿç›‘æ§
- CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
- ç½‘ç»œæµé‡
- å®¹å™¨çŠ¶æ€

### 3. æ—¥å¿—ç®¡ç†
- ç»“æ„åŒ–æ—¥å¿—
- æ—¥å¿—è½®è½¬
- é›†ä¸­æ”¶é›†

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. åº”ç”¨ä¼˜åŒ–
- å¼‚æ­¥å¤„ç†
- è¿æ¥æ± 
- ç¼“å­˜ç­–ç•¥

### 2. åŸºç¡€è®¾æ–½ä¼˜åŒ–
- èµ„æºé™åˆ¶
- è‡ªåŠ¨æ‰©ç¼©å®¹
- è´Ÿè½½å‡è¡¡

### 3. æ•°æ®åº“ä¼˜åŒ–
- ç´¢å¼•ä¼˜åŒ–
- æŸ¥è¯¢ä¼˜åŒ–
- è¿æ¥æ± é…ç½®

## ğŸ§ª æµ‹è¯•

### 1. è´Ÿè½½æµ‹è¯•
```bash
# è¿è¡Œè´Ÿè½½æµ‹è¯•
python load_test.py --requests 100 --concurrency 10

# é«˜å¹¶å‘æµ‹è¯•
python load_test.py --requests 1000 --concurrency 50
```

### 2. å‹åŠ›æµ‹è¯•
```bash
# æŒç»­å‹åŠ›æµ‹è¯•
python load_test.py --requests 5000 --concurrency 100
```

### 3. æ•…éšœæµ‹è¯•
- æ¨¡æ‹ŸæœåŠ¡æ•…éšœ
- ç½‘ç»œåˆ†åŒºæµ‹è¯•
- èµ„æºè€—å°½æµ‹è¯•

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. å®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs langchain-app

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps
```

#### 2. API è°ƒç”¨å¤±è´¥
```bash
# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:8000/health

# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker network ls
```

#### 3. æ€§èƒ½é—®é¢˜
```bash
# æ£€æŸ¥èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½
htop
```

### ç´§æ€¥æ¢å¤
```bash
# é‡å¯æœåŠ¡
docker-compose restart

# å®Œå…¨é‡å»º
docker-compose down
docker-compose up -d
```

## ğŸ“ˆ æ‰©å±•æŒ‡å—

### 1. æ°´å¹³æ‰©å±•
```yaml
# docker-compose.yml
services:
  langchain-app:
    deploy:
      replicas: 3
```

### 2. å¾®æœåŠ¡æ‹†åˆ†
- æ‹†åˆ†ä¸åŒçš„ Agent ç±»å‹
- ç‹¬ç«‹éƒ¨ç½²æœåŠ¡
- æœåŠ¡é—´é€šä¿¡

### 3. äº‘åŸç”Ÿéƒ¨ç½²
- Kubernetes é…ç½®
- Helm Charts
- CI/CD æµæ°´çº¿

## ğŸ”„ å¤‡ä»½å’Œæ¢å¤

### 1. æ•°æ®å¤‡ä»½
```bash
# å¤‡ä»½åº”ç”¨æ•°æ®
docker run --rm -v langchain_data:/data -v $(pwd):/backup alpine tar czf /backup/data-backup-$(date +%Y%m%d).tar.gz -C /data .

# å¤‡ä»½é…ç½®æ–‡ä»¶
tar czf config-backup-$(date +%Y%m%d).tar.gz .env nginx/ monitoring/
```

### 2. æ¢å¤æ•°æ®
```bash
# æ¢å¤åº”ç”¨æ•°æ®
docker run --rm -v langchain_data:/data -v $(pwd):/backup alpine tar xzf /backup/data-backup-20241014.tar.gz -C /data
```

## ğŸ“ æ”¯æŒå’Œç»´æŠ¤

### 1. ç›‘æ§å‘Šè­¦
- è®¾ç½®å…³é”®æŒ‡æ ‡å‘Šè­¦
- é‚®ä»¶/çŸ­ä¿¡é€šçŸ¥
- è‡ªåŠ¨æ•…éšœæ¢å¤

### 2. å®šæœŸç»´æŠ¤
- ä¾èµ–æ›´æ–°
- å®‰å…¨è¡¥ä¸
- æ€§èƒ½è°ƒä¼˜

### 3. ç‰ˆæœ¬å‡çº§
- è“ç»¿éƒ¨ç½²
- é‡‘ä¸é›€å‘å¸ƒ
- å›æ»šç­–ç•¥

---

## ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] Docker å’Œ Docker Compose å®‰è£…
- [ ] ç½‘ç»œç«¯å£å¯ç”¨
- [ ] SSL è¯ä¹¦é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] ç›‘æ§ç³»ç»Ÿé…ç½®
- [ ] æ—¥å¿—ç³»ç»Ÿé…ç½®
- [ ] å¤‡ä»½ç­–ç•¥åˆ¶å®š
- [ ] å®‰å…¨é…ç½®éªŒè¯
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] æ•…éšœæ¢å¤æµ‹è¯•

éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®ä¿æ‰€æœ‰æ£€æŸ¥é¡¹éƒ½å·²å®Œæˆã€‚

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥å®¹å™¨æ—¥å¿—
3. è¿è¡Œå¥åº·æ£€æŸ¥
4. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ